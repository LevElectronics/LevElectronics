<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>LevElectronics ‚Äî –ú–∞–≥–∞–∑–∏–Ω —Ä–æ–±–æ—Ç–æ–≤ –∏ –º–æ–¥—É–ª–µ–π</title>
  <style>
    :root{
      --bg:#ffffff;
      --blue:#00AEEF; /* –æ—Å–Ω–æ–≤–Ω–æ–π —è—Ä–∫–∏–π –≥–æ–ª—É–±–æ–π */
      --blue-100:#E6F9FF; /* —Å–≤–µ—Ç–ª—ã–π —Ñ–æ–Ω–Ω—ã–π –≥–æ–ª—É–±–æ–π */
      --text:#0b2030;
      --muted:#6b7b86;
      --card-shadow: 0 6px 18px rgba(8,28,40,0.08);
      --radius:12px;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);line-height:1.4}
    header{background:linear-gradient(180deg,var(--blue-100),#fff);border-bottom:1px solid rgba(10,30,50,0.04);position:sticky;top:0;z-index:50}
    .container{max-width:1100px;margin:0 auto;padding:18px}
    .nav{display:flex;align-items:center;gap:18px}
    .brand{font-weight:700;font-size:20px;color:var(--blue);letter-spacing:0.2px}
    nav a{color:var(--text);text-decoration:none;padding:8px;border-radius:8px}
    nav a.active, nav a:hover{background:rgba(0,174,239,0.12);color:var(--blue)}
    .search{margin-left:auto;display:flex;gap:8px;align-items:center}
    .search input{padding:8px 12px;border-radius:10px;border:1px solid rgba(10,30,50,0.06);min-width:180px}
    .icon-btn{background:transparent;border:0;padding:8px;border-radius:10px;cursor:pointer}
    main{padding:28px 0}
    /* layout */
    .grid{display:grid;grid-template-columns:1fr 320px;gap:24px}
    .hero{padding:18px;background:linear-gradient(90deg,rgba(0,174,239,0.06),transparent);border-radius:12px;box-shadow:var(--card-shadow)}
    .cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:18px;margin-top:18px}
    .card{background:#fff;border-radius:12px;padding:12px;box-shadow:var(--card-shadow);display:flex;flex-direction:column;gap:8px}
    .card img{width:100%;height:140px;object-fit:contain}
    .price{font-weight:700;color:var(--blue)}
    .muted{color:var(--muted);font-size:13px}
    .btn{background:var(--blue);color:white;border:0;padding:10px 12px;border-radius:10px;cursor:pointer}
    .ghost{background:transparent;border:1px solid rgba(10,30,50,0.06);padding:8px;border-radius:10px}
    /* sidebar */
    .panel{background:#fff;padding:12px;border-radius:12px;box-shadow:var(--card-shadow)}
    .cat-list{display:flex;flex-direction:column;gap:8px}
    .cat-item{cursor:pointer;padding:8px;border-radius:8px}
    .cat-item.active{background:rgba(0,174,239,0.06);color:var(--blue)}
    /* cart */
    .cart-item{display:flex;gap:10px;align-items:center}
    .qty{display:flex;gap:6px;align-items:center}
    input[type=number]{width:62px;padding:6px;border-radius:6px;border:1px solid rgba(10,30,50,0.06)}
    /* account */
    .field{display:flex;flex-direction:column;gap:6px}
    label{font-size:13px;color:var(--muted)}
    /* responsive */
    @media (max-width:900px){
      .grid{grid-template-columns:1fr}
      .search input{min-width:100px}
    }
    /* small helpers */
    .center{display:flex;align-items:center;justify-content:center}
    a.link{color:var(--blue);text-decoration:none}
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <div class="brand">LevElectronics</div>
      <nav>
        <a href="#home" data-link>–ì–ª–∞–≤–Ω–∞—è</a>
        <a href="#catalog" data-link>–ö–∞—Ç–∞–ª–æ–≥</a>
        <a href="#cart" data-link>–ö–æ—Ä–∑–∏–Ω–∞ (<span id="cart-count">0</span>)</a>
        <a href="#account" data-link id="nav-account">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
      </nav>
      <div class="search">
        <input id="search" placeholder="–ü–æ–∏—Å–∫ –ø–æ —Ç–æ–≤–∞—Ä–∞–º..." />
        <button class="icon-btn" id="clear-search" title="–û—á–∏—Å—Ç–∏—Ç—å">‚úñ</button>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- PAGES (single file multi-page via hash routing) -->

    <section id="page-home" data-page>
      <div class="hero">
        <div style="display:flex;gap:18px;align-items:center;justify-content:space-between;">
          <div>
            <h1 style="margin:0">LevElectronics ‚Äî —Ä–æ–±–æ—Ç—ã –∏ –º–æ–¥—É–ª–∏</h1>
            <p class="muted">–†–æ–±–æ—Ç—ã, ESP32, CC1101, –¥–∞—Ç—á–∏–∫–∏ –∏ –∞–∫—Å–µ—Å—Å—É–∞—Ä—ã ‚Äî –≤—Å—ë –¥–ª—è —à–∫–æ–ª—å–Ω—ã—Ö –∏ —Ö–æ–±–±–∏-–ø—Ä–æ–µ–∫—Ç–æ–≤.</p>
          </div>
          <div class="center" style="gap:12px">
            <div style="text-align:right">
              <div class="muted">–ë—ã—Å—Ç—Ä–∞—è –∫–æ—Ä–∑–∏–Ω–∞</div>
              <div style="font-weight:700;font-size:18px">üíô LevElectronics</div>
            </div>
          </div>
        </div>
      </div>

      <div style="display:flex;gap:18px;margin-top:18px;flex-wrap:wrap;align-items:center">
        <div class="panel" style="flex:1;min-width:240px">
          <h3 style="margin:0 0 8px 0">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h3>
          <div class="cat-list" id="home-cats"></div>
        </div>

        <div style="flex:3;min-width:260px">
          <h3 style="margin:0">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã</h3>
          <div class="cards" id="popular-list"></div>
        </div>
      </div>
    </section>

    <section id="page-catalog" data-page style="display:none">
      <div class="grid">
        <div>
          <div style="display:flex;gap:12px;align-items:center;justify-content:space-between">
            <h2 style="margin:0">–ö–∞—Ç–∞–ª–æ–≥</h2>
            <div class="muted">–ü–æ–∫–∞–∑–∞–Ω–æ: <span id="shown-count">0</span></div>
          </div>

          <div style="margin-top:12px">
            <div style="display:flex;gap:8px;flex-wrap:wrap">
              <select id="filter-cat" class="ghost">
                <option value="all">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
              </select>
              <select id="sort" class="ghost">
                <option value="default">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é</option>
                <option value="price-asc">–ü–æ —Ü–µ–Ω–µ ‚Üë</option>
                <option value="price-desc">–ü–æ —Ü–µ–Ω–µ ‚Üì</option>
              </select>
            </div>

            <div class="cards" id="product-list" style="margin-top:12px"></div>
          </div>
        </div>

        <aside>
          <div class="panel">
            <h3 style="margin:0 0 8px 0">–ö–æ—Ä–∑–∏–Ω–∞</h3>
            <div id="cart-panel"></div>
            <div style="margin-top:10px;display:flex;gap:8px">
              <button class="btn" id="checkout" disabled>–û—Ñ–æ—Ä–º–∏—Ç—å (–∏–º–∏—Ç–∞—Ü–∏—è)</button>
              <button class="ghost" id="clear-cart">–û—á–∏—Å—Ç–∏—Ç—å</button>
            </div>
          </div>

          <div class="panel" style="margin-top:12px">
            <h4 style="margin:0 0 8px 0">–§–∏–ª—å—Ç—Ä –ø–æ —Ü–µ–Ω–µ</h4>
            <div class="muted">–ú–∏–Ω ‚Äî –ú–∞–∫—Å (–≤ —Ä—É–±–ª—è—Ö)</div>
            <div style="display:flex;gap:8px;margin-top:8px">
              <input id="min-price" placeholder="–ú–∏–Ω" />
              <input id="max-price" placeholder="–ú–∞–∫—Å" />
              <button class="btn" id="apply-price">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
            </div>
          </div>
        </aside>
      </div>
    </section>

    <section id="page-cart" data-page style="display:none">
      <div class="grid" style="grid-template-columns:1fr">
        <div>
          <h2>–ö–æ—Ä–∑–∏–Ω–∞</h2>
          <div class="panel" id="cart-full"></div>
        </div>
      </div>
    </section>

    <section id="page-account" data-page style="display:none">
      <div class="grid" style="grid-template-columns:1fr">
        <div>
          <h2>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h2>
          <div class="panel" style="margin-top:12px">
            <div id="account-area"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- product modal -->
    <div id="product-modal" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(6,18,28,0.45);z-index:100">
      <div style="width:880px;max-width:96%;background:#fff;border-radius:12px;padding:18px;box-shadow:0 30px 60px rgba(8,28,40,0.4);">
        <div style="display:flex;gap:18px">
          <div style="flex:1">
            <img id="pm-img" src="" style="width:100%;height:320px;object-fit:contain" />
          </div>
          <div style="width:360px;display:flex;flex-direction:column;gap:8px">
            <h3 id="pm-title"></h3>
            <div class="muted" id="pm-cat"></div>
            <div class="price" id="pm-price"></div>
            <p id="pm-desc" class="muted"></p>
            <div style="display:flex;gap:8px;margin-top:auto">
              <input type="number" id="pm-qty" value="1" min="1" />
              <button class="btn" id="pm-add">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
              <button class="ghost" id="pm-close">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
          </div>
        </div>
      </div>
    </div>

  </main>

  <footer style="padding:18px 0;background:#fbfdff;border-top:1px solid rgba(10,30,50,0.02)">
    <div class="container" style="display:flex;justify-content:space-between;align-items:center">
      <div class="muted">¬© LevElectronics ‚Äî —É—á–µ–±–Ω—ã–π –ø—Ä–æ–µ–∫—Ç</div>
      <div class="muted">–î–∏–∑–∞–π–Ω: –ë–µ–ª–æ-–≥–æ–ª—É–±–∞—è –ø–∞–ª–∏—Ç—Ä–∞</div>
    </div>
  </footer>

  <script>
    // ====== DATA ======
    const PRODUCTS = [
      // Robots
      {id:'r1',title:'Arduino Robot Car',category:'–†–æ–±–æ—Ç—ã',price:3200,desc:'–ù–∞–±–æ—Ä –¥–ª—è —Å–±–æ—Ä–∫–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª—è –Ω–∞ –æ—Å–Ω–æ–≤–µ Arduino. –ü–æ–¥–æ–π–¥–µ—Ç –¥–ª—è —à–∫–æ–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤.',img:'https://cdn.pixabay.com/photo/2016/11/29/03/53/robot-1867023_1280.png'},
      {id:'r2',title:'Line Follower Robot',category:'–†–æ–±–æ—Ç—ã',price:4200,desc:'–†–æ–±–æ—Ç –¥–ª—è —Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –ø–æ –ª–∏–Ω–∏–∏ —Å –¥–∞—Ç—á–∏–∫–æ–º –∏ –º–æ—Ç–æ—Ä—á–∏–∫–∞–º–∏.',img:'https://cdn.pixabay.com/photo/2018/04/13/18/19/robot-3317022_1280.png'},
      {id:'r3',title:'Robotic Arm Kit',category:'–†–æ–±–æ—Ç—ã',price:5800,desc:'–ü–æ–≤–æ—Ä–æ—Ç–Ω—ã–π –º–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä –¥–ª—è –ø—Ä–∞–∫—Ç–∏–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è.',img:'https://cdn.pixabay.com/photo/2016/03/31/19/56/robotic-1295208_1280.png'},
      // Modules
      {id:'m1',title:'ESP32 Dev Module',category:'–ú–æ–¥—É–ª–∏ —Å–≤—è–∑–∏',price:550,desc:'–ü–æ–ø—É–ª—è—Ä–Ω—ã–π –º–æ–¥—É–ª—å Wi‚ÄëFi + Bluetooth, –∏–¥–µ–∞–ª–µ–Ω –¥–ª—è IoT.',img:'https://upload.wikimedia.org/wikipedia/commons/8/83/ESP32-DevKitC.png'},
      {id:'m2',title:'CC1101 RF Module',category:'–ú–æ–¥—É–ª–∏ —Å–≤—è–∑–∏',price:480,desc:'–ù–∏–∑–∫–æ—á–∞—Å—Ç–æ—Ç–Ω—ã–π RF –º–æ–¥—É–ª—å –¥–ª—è —Å–≤—è–∑–∏ –Ω–∞ –¥–∞–ª—å–Ω–∏–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è.',img:'https://upload.wikimedia.org/wikipedia/commons/6/6f/CC1101-Modul2.jpg'},
      {id:'m3',title:'nRF24L01 Module',category:'–ú–æ–¥—É–ª–∏ —Å–≤—è–∑–∏',price:180,desc:'2.4GHz –±–µ—Å–ø—Ä–æ–≤–æ–¥–Ω–æ–π –º–æ–¥—É–ª—å –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Å–µ—Ç–µ–π.',img:'https://upload.wikimedia.org/wikipedia/commons/7/73/Nrf24l01.png'},
      // Sensors
      {id:'s1',title:'Ultrasonic Sensor HC-SR04',category:'–î–∞—Ç—á–∏–∫–∏',price:120,desc:'–ò–∑–º–µ—Ä–µ–Ω–∏–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è —É–ª—å—Ç—Ä–∞–∑–≤—É–∫–æ–º.',img:'https://upload.wikimedia.org/wikipedia/commons/0/0b/HC-SR04_ultrasonic_sensor.jpg'},
      {id:'s2',title:'DHT22 Temperature & Humidity',category:'–î–∞—Ç—á–∏–∫–∏',price:230,desc:'–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∏ –≤–ª–∞–∂–Ω–æ—Å—Ç—å –≤ –æ–¥–Ω–æ–º –º–æ–¥—É–ª–µ.',img:'https://upload.wikimedia.org/wikipedia/commons/7/74/DHT22.jpg'},
      {id:'s3',title:'IR Line Sensor',category:'–î–∞—Ç—á–∏–∫–∏',price:90,desc:'–°–µ–Ω—Å–æ—Ä –ª–∏–Ω–∏–∏ –¥–ª—è —Ä–æ–±–æ—Ç–æ–≤‚Äë—Å–ª–µ–¥–æ–ø—ã—Ç–æ–≤.',img:'https://cdn.pixabay.com/photo/2016/10/11/23/54/sensor-1733536_1280.jpg'},
      // Accessories
      {id:'a1',title:'Breadboard 400 pins',category:'–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã',price:150,desc:'–ú–∞–∫–µ—Ç–Ω–∞—è –ø–ª–∞—Ç–∞ –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –ø—Ä–æ—Ç–æ—Ç–∏–ø–æ–≤.',img:'https://cdn.pixabay.com/photo/2017/02/01/22/02/breadboard-2037282_1280.jpg'},
      {id:'a2',title:'Jumper Wires Kit',category:'–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã',price:120,desc:'–ù–∞–±–æ—Ä –ø—Ä–æ–≤–æ–¥–æ–≤ –¥–ª—è –º–∞–∫–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.',img:'https://cdn.pixabay.com/photo/2017/01/04/23/17/wires-1955838_1280.jpg'},
      {id:'a3',title:'ESP32 Camera Module',category:'–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã',price:900,desc:'–ú–æ–¥—É–ª—å –∫–∞–º–µ—Ä—ã –¥–ª—è ESP32 (–≤–∫–ª—é—á–∞–µ—Ç –∫–∞–±–µ–ª—å).',img:'https://cdn.pixabay.com/photo/2018/01/14/23/12/arduino-3080422_1280.jpg'}
    ];

    // ====== STATE ======
    let state = {
      products: PRODUCTS.slice(),
      cart: JSON.parse(localStorage.getItem('lev_cart')||'{}'), // {id:qty}
      user: JSON.parse(localStorage.getItem('lev_user')||'null'),
      filters: {query:'',category:'all',sort:'default',minPrice:null,maxPrice:null}
    };

    // ====== UTIL ======
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));

    function saveCart(){ localStorage.setItem('lev_cart', JSON.stringify(state.cart)); renderCartCount(); renderCartPanel(); }
    function saveUser(){ localStorage.setItem('lev_user', JSON.stringify(state.user)); renderAccount(); updateNavAccount(); }

    function renderCartCount(){ const count = Object.values(state.cart).reduce((s,n)=>s+Number(n),0); $('#cart-count').textContent = count; }

    // ====== ROUTER ======
    function showPage(hash){
      const pages = $$('[data-page]');
      pages.forEach(p=>p.style.display='none');
      const pageId = hash ? 'page-'+hash.replace('#','') : 'page-home';
      const el = document.getElementById(pageId) || document.getElementById('page-home');
      el.style.display='block';

      // highlight nav
      $$('nav a').forEach(a=>a.classList.remove('active'));
      $$('nav a').forEach(a=>{ if(a.getAttribute('href')===hash) a.classList.add('active'); });
    }

    window.addEventListener('hashchange', ()=> showPage(location.hash||'#home'));

    // ====== RENDER PRODUCTS ======
    function formatPrice(p){ return p.toLocaleString('ru-RU') + ' ‚ÇΩ'; }

    function renderCategoryList(){
      const cats = ['–†–æ–±–æ—Ç—ã','–ú–æ–¥—É–ª–∏ —Å–≤—è–∑–∏','–î–∞—Ç—á–∏–∫–∏','–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã'];
      const homeCats = $('#home-cats'); homeCats.innerHTML='';
      const filter = $('#filter-cat'); filter.innerHTML='<option value="all">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>';
      cats.forEach(c=>{
        const d = document.createElement('div'); d.className='cat-item'; d.textContent=c; d.onclick=()=>{ state.filters.category=c; filter.value=c; renderProducts(); highlightCats(c); location.hash='#catalog'; };
        homeCats.appendChild(d);
        const opt = document.createElement('option'); opt.value=c; opt.textContent=c; filter.appendChild(opt);
      });
    }
    function highlightCats(c){ $$('.cat-item').forEach(el=>el.classList.toggle('active', el.textContent===c)); }

    function renderProducts(){
      const q = state.filters.query.trim().toLowerCase();
      let list = state.products.slice();
      if(state.filters.category && state.filters.category!=='all') list = list.filter(p=>p.category===state.filters.category);
      if(q) list = list.filter(p=> (p.title+p.desc+p.category).toLowerCase().includes(q));
      if(state.filters.minPrice) list = list.filter(p=>p.price >= state.filters.minPrice);
      if(state.filters.maxPrice) list = list.filter(p=>p.price <= state.filters.maxPrice);
      if(state.filters.sort==='price-asc') list.sort((a,b)=>a.price-b.price);
      if(state.filters.sort==='price-desc') list.sort((a,b)=>b.price-a.price);

      $('#shown-count').textContent = list.length;

      const container = $('#product-list'); container.innerHTML='';
      list.forEach(p=>{
        const card = document.createElement('div'); card.className='card';
        card.innerHTML = `
          <img src="${p.img}" alt="${p.title}" onerror="this.style.objectFit='cover';this.src='https://via.placeholder.com/300x180?text=No+Image'" />
          <div style=display:flex;flex-direction:column;gap:6px>
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div style="font-weight:600">${p.title}</div>
              <div class="price">${formatPrice(p.price)}</div>
            </div>
            <div class="muted" style="font-size:13px">${p.category}</div>
            <div style="display:flex;gap:8px;margin-top:6px">
              <button class="btn" data-buy="${p.id}">–ö—É–ø–∏—Ç—å</button>
              <button class="ghost" data-view="${p.id}">–û—Ç–∫—Ä—ã—Ç—å</button>
            </div>
          </div>
        `;
        container.appendChild(card);
      });

      // popular list (first 6)
      const pop = $('#popular-list'); pop.innerHTML='';
      state.products.slice(0,6).forEach(p=>{
        const c = document.createElement('div'); c.className='card'; c.style.flexDirection='row'; c.style.alignItems='center'; c.innerHTML = `<img src="${p.img}" style="width:84px;height:64px" /><div style="flex:1"><div style="font-weight:600">${p.title}</div><div class="muted">${formatPrice(p.price)}</div></div><div><button class='btn' data-buy='${p.id}'>–ö—É–ø–∏—Ç—å</button></div>`;
        pop.appendChild(c);
      });

      // attach events
      $$('[data-buy]').forEach(b=>b.onclick = (e)=>{ const id = e.currentTarget.dataset.buy; openAddToCart(id,1);} );
      $$('[data-view]').forEach(b=>b.onclick = (e)=>{ const id = e.currentTarget.dataset.view; openProductModal(id);} );
    }

    // ====== PRODUCT MODAL & CART ======
    function openProductModal(id){ const p = state.products.find(x=>x.id===id); if(!p) return; $('#pm-img').src=p.img; $('#pm-title').textContent=p.title; $('#pm-cat').textContent=p.category; $('#pm-price').textContent=formatPrice(p.price); $('#pm-desc').textContent=p.desc; $('#pm-qty').value=1; $('#product-modal').style.display='flex';
      $('#pm-add').onclick = ()=>{ addToCart(id, Number($('#pm-qty').value||1)); $('#product-modal').style.display='none'; };
      $('#pm-close').onclick = ()=> $('#product-modal').style.display='none';
    }

    function openAddToCart(id,qty=1){ addToCart(id,qty); location.hash='#cart'; }

    function addToCart(id,qty=1){ state.cart[id] = (state.cart[id]||0) + Number(qty); saveCart(); }

    function renderCartPanel(){
      const el = $('#cart-panel'); el.innerHTML='';
      const entries = Object.keys(state.cart);
      if(entries.length===0){ el.innerHTML = '<div class="muted">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>'; $('#checkout').disabled=true; return; }
      $('#checkout').disabled=false;
      entries.forEach(id=>{
        const p = state.products.find(x=>x.id===id);
        const row = document.createElement('div'); row.className='cart-item'; row.style.marginBottom='10px';
        row.innerHTML = `<div style='flex:1'><div style='font-weight:600'>${p.title}</div><div class='muted'>${formatPrice(p.price)}</div></div><div style='display:flex;flex-direction:column;align-items:flex-end;gap:6px'><div class='qty'><button class='ghost' data-dec='${id}'>-</button><input type='number' min='1' data-qty='${id}' value='${state.cart[id]}' /><button class='ghost' data-inc='${id}'>+</button></div><div style='font-weight:700'>${formatPrice(p.price * state.cart[id])}</div></div>`;
        el.appendChild(row);
      });

      // events
      $$('[data-inc]').forEach(b=>b.onclick = (e)=>{ const id=e.currentTarget.dataset.inc; state.cart[id]++; saveCart(); });
      $$('[data-dec]').forEach(b=>b.onclick = (e)=>{ const id=e.currentTarget.dataset.dec; state.cart[id] = Math.max(0, state.cart[id]-1); if(state.cart[id]==0) delete state.cart[id]; saveCart(); });
      $$('[data-qty]').forEach(inp=>{ inp.onchange = (e)=>{ const id=e.currentTarget.dataset.qty; const v = Math.max(1, Number(e.currentTarget.value||1)); state.cart[id]=v; saveCart(); }; });
    }

    function renderCartFull(){ const el = $('#cart-full'); el.innerHTML=''; const keys = Object.keys(state.cart); if(keys.length===0) { el.innerHTML='<div class="muted">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>'; return; }
      const table = document.createElement('div'); table.style.display='flex'; table.style.flexDirection='column'; table.style.gap='12px';
      let total=0;
      keys.forEach(id=>{ const p=state.products.find(x=>x.id===id); const qty=state.cart[id]; total+=p.price*qty; const row=document.createElement('div'); row.style.display='flex'; row.style.justifyContent='space-between'; row.innerHTML = `<div style='display:flex;gap:12px;align-items:center'><img src='${p.img}' style='width:70px;height:50px;object-fit:contain' /><div><div style='font-weight:600'>${p.title}</div><div class='muted'>${p.category}</div></div></div><div style='text-align:right'><div>${qty} √ó ${formatPrice(p.price)}</div><div style='font-weight:700;margin-top:6px'>${formatPrice(p.price*qty)}</div></div>`; table.appendChild(row); });
      const foot = document.createElement('div'); foot.style.display='flex'; foot.style.justifyContent='space-between'; foot.style.alignItems='center'; foot.innerHTML = `<div style='font-weight:700'>–ò—Ç–æ–≥–æ: ${formatPrice(total)}</div><div><button class='btn' id='fake-pay'>–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑ (–∏–º–∏—Ç–∞—Ü–∏—è)</button> <button class='ghost' id='cart-clear-2'>–û—á–∏—Å—Ç–∏—Ç—å</button></div>`;
      el.appendChild(table); el.appendChild(foot);
      document.getElementById('fake-pay').onclick = ()=>{ alert('–ü–æ—Å–∫–æ–ª—å–∫—É —ç—Ç–æ —É—á–µ–±–Ω—ã–π –ø—Ä–æ–µ–∫—Ç, –ø–ª–∞—Ç–µ–∂ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω. –°–ø–∞—Å–∏–±–æ!'); };
      document.getElementById('cart-clear-2').onclick = ()=>{ state.cart={}; saveCart(); renderCartFull(); };
    }

    // ====== ACCOUNT ======
    function renderAccount(){ const area = $('#account-area'); area.innerHTML=''; if(!state.user){ area.innerHTML = `<div class='field'><label>–ò–º—è</label><input id='acc-name' /></div><div class='field' style='margin-top:8px'><label>Email</label><input id='acc-email' /></div><div style='margin-top:10px;display:flex;gap:8px'><button class='btn' id='acc-save'>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button><button class='ghost' id='acc-logout'>–û—á–∏—Å—Ç–∏—Ç—å</button></div>`; $('#acc-save').onclick = ()=>{ const name=$('#acc-name').value.trim(); const email=$('#acc-email').value.trim(); if(!name||!email){ alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ email'); return; } state.user={name,email}; saveUser(); }; $('#acc-logout').onclick = ()=>{ state.user=null; saveUser(); }; } else { area.innerHTML = `<div>–ü—Ä–∏–≤–µ—Ç, <b>${state.user.name}</b> (<span class='muted'>${state.user.email}</span>)</div><div style='margin-top:12px'><button class='btn' id='acc-edit'>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button> <button class='ghost' id='acc-clear'>–í—ã–π—Ç–∏</button></div>`; $('#acc-edit').onclick = ()=>{ state.user=null; saveUser(); }; $('#acc-clear').onclick = ()=>{ state.user=null; saveUser(); }; }
    }

    function updateNavAccount(){ $('#nav-account').textContent = state.user ? `–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç (${state.user.name})` : '–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç'; }

    // ====== INIT ======
    function init(){
      renderCategoryList(); renderProducts(); renderCartCount(); renderCartPanel(); renderAccount(); updateNavAccount();

      // events
      $('#search').addEventListener('input', (e)=>{ state.filters.query=e.target.value; renderProducts(); });
      $('#clear-search').onclick = ()=>{ $('#search').value=''; state.filters.query=''; renderProducts(); };
      $('#filter-cat').onchange = (e)=>{ state.filters.category = e.target.value; renderProducts(); };
      $('#sort').onchange = (e)=>{ state.filters.sort = e.target.value; renderProducts(); };
      $('#apply-price').onclick = ()=>{ const mi = Number($('#min-price').value) || null; const ma = Number($('#max-price').value) || null; state.filters.minPrice = mi; state.filters.maxPrice = ma; renderProducts(); };

      $('#clear-cart').onclick = ()=>{ if(confirm('–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É?')){ state.cart={}; saveCart(); } };
      $('#checkout').onclick = ()=>{ location.hash='#cart'; };

      // initial route
      if(!location.hash) location.hash='#home';
      showPage(location.hash);

      // render cart full when opening cart page
      window.addEventListener('hashchange', ()=>{ if(location.hash==='#cart') renderCartFull(); });

      // also update panels when cart changes
      const origSave = saveCart; saveCart = ()=>{ localStorage.setItem('lev_cart', JSON.stringify(state.cart)); renderCartCount(); renderCartPanel(); renderCartFull(); };
      // ensure cart is saved on unload (localStorage persists anyway)
      window.addEventListener('beforeunload', ()=> localStorage.setItem('lev_cart', JSON.stringify(state.cart)) );

      // initialize modal close on background click
      $('#product-modal').onclick = (e)=>{ if(e.target.id==='product-modal') $('#product-modal').style.display='none'; };

      // hook buy buttons from popular & home
      document.body.addEventListener('click', (e)=>{ if(e.target.matches('[data-buy]')){ const id = e.target.dataset.buy; addToCart(id,1); } });
    }

    init();
  </script>
</body>
</html>
